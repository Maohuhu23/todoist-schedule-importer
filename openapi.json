{
  "openapi": "3.1.0",
  "info": {
    "title": "Todoist Schedule Importer v2",
    "version": "2.0.0",
    "description": "批量将结构化课表/时间块导入 Todoist 的服务，支持导入模式、dry_run 和全局默认选项。"
  },
  "servers": [
    {
      "url": "https://你的服务.onrender.com"
    }
  ],
  "paths": {
    "/import_schedule_to_todoist": {
      "post": {
        "operationId": "importScheduleToTodoist",
        "summary": "批量导入课表到 Todoist",
        "description": "接收一组课程/时间块描述，把它们转换成 Todoist 任务（自动创建项目和标签），支持 create / replace_project / dry_run 等选项。",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ImportRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "导入结果，包含成功创建的任务及错误信息。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ImportResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ScheduleItem": {
        "type": "object",
        "description": "一条课 / 时间块，对应一个 Todoist 任务。",
        "properties": {
          "title": {
            "type": "string",
            "description": "任务标题或课程名，例如 'A2-1 Further Math'"
          },
          "description": {
            "type": "string",
            "description": "备注，例如教室、老师、上课方式等"
          },
          "project_name": {
            "type": "string",
            "description": "Todoist 项目名，不存在时会自动创建"
          },
          "labels": {
            "type": "array",
            "description": "标签名列表，不存在的会自动创建",
            "items": {
              "type": "string"
            }
          },
          "priority": {
            "type": "integer",
            "minimum": 1,
            "maximum": 4,
            "default": 1,
            "description": "Todoist 优先级（1~4，4 为最高）"
          },
          "due_string": {
            "type": "string",
            "description": "Todoist 自然语言时间，例如 'every Monday at 9:00'"
          },
          "start_datetime": {
            "type": "string",
            "format": "date-time",
            "description": "开始时间，ISO 8601 格式，例如 '2025-11-18T09:00:00+08:00'"
          },
          "end_datetime": {
            "type": "string",
            "format": "date-time",
            "description": "结束时间，会写进 description 方便查看"
          },
          "timezone": {
            "type": "string",
            "description": "IANA 时区字符串，例如 'Asia/Singapore'"
          }
        },
        "required": ["title"]
      },
      "ImportOptions": {
        "type": "object",
        "description": "控制本次导入行为的全局选项。",
        "properties": {
          "mode": {
            "type": "string",
            "enum": ["create", "replace_project"],
            "default": "create",
            "description": "导入模式：create=只追加任务；replace_project=清空某项目后再创建"
          },
          "replace_project_name": {
            "type": "string",
            "description": "当 mode=replace_project 时，要被清空并重建的项目名"
          },
          "dry_run": {
            "type": "boolean",
            "default": false,
            "description": "为 true 时不真正调用 Todoist，只返回会创建哪些任务（task_id 为 'dry-run'）"
          },
          "default_project_name": {
            "type": "string",
            "description": "items 未指定 project_name 时的默认项目名"
          },
          "default_labels": {
            "type": "array",
            "description": "items 未指定 labels 时的默认标签列表",
            "items": {
              "type": "string"
            }
          },
          "default_priority": {
            "type": "integer",
            "minimum": 1,
            "maximum": 4,
            "default": 1,
            "description": "items 未设置 priority 时的默认优先级（1~4）"
          },
          "default_timezone": {
            "type": "string",
            "default": "Asia/Singapore",
            "description": "items 未设置 timezone 时的默认时区"
          },
          "title_prefix": {
            "type": "string",
            "description": "给所有任务标题统一加的前缀，例如 '[课表] '"
          },
          "title_suffix": {
            "type": "string",
            "description": "给所有任务标题统一加的后缀"
          }
        }
      },
      "ImportRequest": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "minItems": 1,
            "items": {
              "$ref": "#/components/schemas/ScheduleItem"
            }
          },
          "options": {
            "$ref": "#/components/schemas/ImportOptions"
          }
        },
        "required": ["items"]
      },
      "CreatedTask": {
        "type": "object",
        "properties": {
          "index": {
            "type": "integer",
            "description": "对应原始 items 数组里的下标"
          },
          "task_id": {
            "type": "string",
            "description": "创建出的 Todoist 任务 ID；dry_run 模式下为 'dry-run'"
          },
          "content": {
            "type": "string",
            "description": "任务标题"
          },
          "project_id": {
            "type": "string",
            "nullable": true,
            "description": "任务所在项目 ID"
          },
          "dry_run": {
            "type": "boolean",
            "description": "是否为 dry_run 模拟结果"
          }
        },
        "required": ["index", "task_id", "content"]
      },
      "ErrorInfo": {
        "type": "object",
        "properties": {
          "index": {
            "type": "integer",
            "description": "出错的那条 items 下标"
          },
          "message": {
            "type": "string",
            "description": "错误信息（用于调试）"
          }
        },
        "required": ["index", "message"]
      },
      "ImportResponse": {
        "type": "object",
        "properties": {
          "created": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CreatedTask"
            }
          },
          "errors": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ErrorInfo"
            }
          }
        }
      }
    }
  }
}
